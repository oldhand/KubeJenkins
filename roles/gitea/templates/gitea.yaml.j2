# Gitea离线部署配置（单节点+内置SQLite+hostPath挂载）
image:
  registry: swr.cn-north-4.myhuaweicloud.com/ddn-k8s/docker.io
  repository: gitea/gitea
  tag: 1.24.3
  rootless: false
  pullPolicy: Never  # 仅使用本地镜像


tolerations:
  - key: "node-role.kubernetes.io/control-plane"
    operator: "Exists"
    effect: "NoSchedule"

# 禁用所有外部依赖
postgresql:
  enabled: false

postgresql-ha:
  enabled: false

valkey:
  enabled: false

valkey-cluster:
  enabled: false

# 内置SQLite数据库配置
gitea:
  config:
    mailer:
      ENABLED: true
      MAILER_TYPE: smtp
      SMTP_ADDR: smtp.qq.com
      SMTP_PORT: 465
      SMTP_FROM: "Gitea <68594864@qq.com>"
      SMTP_USER: "68594864@qq.com"
      SMTP_SSL: false
      SMTP_TLS: true
      SEND_AS_PLAIN_TEXT: false
    database:
      DB_TYPE: sqlite3
      PATH: /data/gitea.db  # 数据库文件存储在挂载目录
    cache:
      ENABLED: false  # 禁用缓存（无Valkey）
  admin:
    username: admin  # 初始管理员账号（可修改）
    password: admin  # 初始密码（部署后建议修改）
    email: 68594864@qq.com

  # 从 Secret 注入 SMTP 密码（敏感信息）
  additionalConfigFromEnvs:
    - name: GITEA__MAILER__SMTP_PASS  # 对应 app.ini 的 [mailer] 中的 SMTP_PASS
      valueFrom:
        secretKeyRef:
          name: gitea-smtp-secret     # 提前创建的存储 SMTP 密码的 Secret 名称
          key: smtp-pass              # Secret 中存储密码的 key

# 持久化配置（直接挂载hostPath，无PVC）
persistence:
  enabled: true
  hostPath: /data/gitea  # 主机目录，自动创建
  accessModes:
    - ReadWriteOnce
  size: 20Gi  # 仅作标识，不限制实际存储
